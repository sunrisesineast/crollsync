/*! For license information please see offscreen.js.LICENSE.txt */
(()=>{"use strict";var e,n,r={339:(e,n,r)=>{var o=r(223),t=r(517);function c(){var e,n,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",t=r.toStringTag||"@@toStringTag";function s(r,o,t,c){var s=o&&o.prototype instanceof a?o:a,l=Object.create(s.prototype);return i(l,"_invoke",function(r,o,t){var c,i,s,a=0,l=t||[],f=!1,y={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(n,r){return c=n,i=0,s=e,y.n=r,u}};function p(r,o){for(i=r,s=o,n=0;!f&&a&&!t&&n<l.length;n++){var t,c=l[n],p=y.p,d=c[2];r>3?(t=d===o)&&(s=c[(i=c[4])?5:(i=3,3)],c[4]=c[5]=e):c[0]<=p&&((t=r<2&&p<c[1])?(i=0,y.v=o,y.n=c[1]):p<d&&(t=r<3||c[0]>o||o>d)&&(c[4]=r,c[5]=o,y.n=d,i=0))}if(t||r>1)return u;throw f=!0,o}return function(t,l,d){if(a>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,d),i=l,s=d;(n=i<2?e:s)||!f;){c||(i?i<3?(i>1&&(y.n=-1),p(i,s)):y.n=s:y.v=s);try{if(a=2,c){if(i||(t="next"),n=c[t]){if(!(n=n.call(c,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,i<2&&(i=0)}else 1===i&&(n=c.return)&&n.call(c),i<2&&(s=TypeError("The iterator does not provide a '"+t+"' method"),i=1);c=e}else if((n=(f=y.n<0)?s:r.call(o,y))!==u)break}catch(n){c=e,i=1,s=n}finally{a=1}}return{value:n,done:f}}}(r,t,c),!0),l}var u={};function a(){}function l(){}function f(){}n=Object.getPrototypeOf;var y=[][o]?n(n([][o]())):(i(n={},o,function(){return this}),n),p=f.prototype=a.prototype=Object.create(y);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,i(e,t,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=f,i(p,"constructor",f),i(f,"constructor",l),l.displayName="GeneratorFunction",i(f,t,"GeneratorFunction"),i(p),i(p,t,"Generator"),i(p,o,function(){return this}),i(p,"toString",function(){return"[object Generator]"}),(c=function(){return{w:s,m:d}})()}function i(e,n,r,o){var t=Object.defineProperty;try{t({},"",{})}catch(e){t=0}i=function(e,n,r,o){function c(n,r){i(e,n,function(e){return this._invoke(n,r,e)})}n?t?t(e,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[n]=r:(c("next",0),c("throw",1),c("return",2))},i(e,n,r,o)}function s(e,n,r,o,t,c,i){try{var s=e[c](i),u=s.value}catch(e){return void r(e)}s.done?n(u):Promise.resolve(u).then(o,t)}function u(e){return function(){var n=this,r=arguments;return new Promise(function(o,t){var c=e.apply(n,r);function i(e){s(c,o,t,i,u,"next",e)}function u(e){s(c,o,t,i,u,"throw",e)}i(void 0)})}}console.log("Crunchyroll Sync: Offscreen script loaded");var a={apiKey:"AIzaSyBPEckKjp8aFmX58uos3MaK873RGuL30Nc",authDomain:"crunchysync-fe757.firebaseapp.com",databaseURL:"https://crunchysync-fe757-default-rtdb.firebaseio.com",projectId:"crunchysync-fe757",storageBucket:"crunchysync-fe757.firebasestorage.app",messagingSenderId:"891082210535",appId:"1:891082210535:web:53225e1bebc5b5d2e03642"},l=null,f=null,y=null,p=null,d=null;function g(){return h.apply(this,arguments)}function h(){return(h=u(c().m(function e(){var n,r,o,i;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("Crunchyroll Sync: Starting Google sign-in"),S("info","Signing in with Google..."),y.disabled=!0,p.disabled=!0,(n=new t.HF).addScope("email"),n.addScope("profile"),e.n=1,(0,t.df)(f,n);case 1:r=e.v,console.log("Crunchyroll Sync: Google sign-in successful:",r.user),S("success","Successfully signed in with Google"),e.n=3;break;case 2:e.p=2,i=e.v,console.error("Crunchyroll Sync: Google sign-in error:",i),o="Failed to sign in with Google","auth/popup-closed-by-user"===i.code?o="Sign-in cancelled by user":"auth/popup-blocked"===i.code?o="Popup blocked. Please allow popups for this extension.":i.message&&(o=i.message),S("error",o);case 3:return e.p=3,y.disabled=!1,p.disabled=!1,e.f(3);case 4:return e.a(2)}},e,null,[[0,2,3,4]])}))).apply(this,arguments)}function m(){return b.apply(this,arguments)}function b(){return(b=u(c().m(function e(){var n,r;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("Crunchyroll Sync: Starting anonymous sign-in"),S("info","Signing in as guest..."),y.disabled=!0,p.disabled=!0,e.n=1,(0,t.zK)(f);case 1:n=e.v,console.log("Crunchyroll Sync: Anonymous sign-in successful:",n.user),S("success","Successfully signed in as guest"),e.n=3;break;case 2:e.p=2,r=e.v,console.error("Crunchyroll Sync: Anonymous sign-in error:",r),S("error","Failed to sign in as guest: "+r.message);case 3:return e.p=3,y.disabled=!1,p.disabled=!1,e.f(3);case 4:return e.a(2)}},e,null,[[0,2,3,4]])}))).apply(this,arguments)}function v(){return(v=u(c().m(function e(){var n;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("Crunchyroll Sync: Signing out"),S("info","Signing out..."),e.n=1,(0,t.CI)(f);case 1:console.log("Crunchyroll Sync: Sign-out successful"),S("info","Signed out successfully"),e.n=3;break;case 2:e.p=2,n=e.v,console.error("Crunchyroll Sync: Sign-out error:",n),S("error","Failed to sign out: "+n.message);case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function S(e,n){d.className="status ".concat(e),d.textContent=n,d.style.display="block","success"===e&&setTimeout(function(){d.style.display="none"},3e3)}document.addEventListener("DOMContentLoaded",function(){console.log("Crunchyroll Sync: Offscreen DOM loaded"),y=document.getElementById("googleAuthBtn"),p=document.getElementById("anonymousAuthBtn"),d=document.getElementById("status"),function(){try{console.log("Crunchyroll Sync: Initializing Firebase in offscreen"),l=(0,o.Wp)(a),f=(0,t.xI)(l),(0,t.hg)(f,function(e){console.log("Crunchyroll Sync: Auth state changed:",e?"signed in":"signed out"),e?(S("success","Signed in as ".concat(e.displayName||e.email||"Anonymous")),chrome.runtime.sendMessage({action:"authStateChanged",user:{uid:e.uid,email:e.email,displayName:e.displayName,isAnonymous:e.isAnonymous}}).catch(function(e){console.error("Crunchyroll Sync: Error sending auth state:",e)})):S("info","Not signed in")}),console.log("Crunchyroll Sync: Firebase initialized successfully in offscreen")}catch(e){console.error("Crunchyroll Sync: Error initializing Firebase:",e),S("error","Failed to initialize Firebase: "+e.message)}}(),y.addEventListener("click",g),p.addEventListener("click",m),setTimeout(function(){m()},1e3),chrome.runtime.onMessage.addListener(function(e,n,r){switch(console.log("Crunchyroll Sync: Offscreen received message:",e),e.action){case"signInWithGoogle":g();break;case"signInAnonymously":m();break;case"signOut":!function(){v.apply(this,arguments)}();break;case"getCurrentUser":return function(e){try{var n=f.currentUser;e(n?{success:!0,user:{uid:n.uid,email:n.email,displayName:n.displayName,isAnonymous:n.isAnonymous}}:{success:!0,user:null})}catch(n){console.error("Crunchyroll Sync: Error getting current user:",n),e({success:!1,error:n.message})}}(r),!0;default:console.log("Crunchyroll Sync: Unknown action:",e.action),r({success:!1,error:"Unknown action"})}})})}},o={};function t(e){var n=o[e];if(void 0!==n)return n.exports;var c=o[e]={exports:{}};return r[e](c,c.exports,t),c.exports}t.m=r,t.x=()=>{var e=t.O(void 0,[911],()=>t(339));return t.O(e)},e=[],t.O=(n,r,o,c)=>{if(!r){var i=1/0;for(l=0;l<e.length;l++){for(var[r,o,c]=e[l],s=!0,u=0;u<r.length;u++)(!1&c||i>=c)&&Object.keys(t.O).every(e=>t.O[e](r[u]))?r.splice(u--,1):(s=!1,c<i&&(i=c));if(s){e.splice(l--,1);var a=o();void 0!==a&&(n=a)}}return n}c=c||0;for(var l=e.length;l>0&&e[l-1][2]>c;l--)e[l]=e[l-1];e[l]=[r,o,c]},t.d=(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},t.f={},t.e=e=>Promise.all(Object.keys(t.f).reduce((n,r)=>(t.f[r](e,n),n),[])),t.u=e=>e+".js",t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var n=t.g.document;if(!e&&n&&(n.currentScript&&"SCRIPT"===n.currentScript.tagName.toUpperCase()&&(e=n.currentScript.src),!e)){var r=n.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=r[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),(()=>{var e={522:1};t.f.i=(n,r)=>{e[n]||importScripts(t.p+t.u(n))};var n=self.webpackChunkcrunchyroll_sync_extension=self.webpackChunkcrunchyroll_sync_extension||[],r=n.push.bind(n);n.push=n=>{var[o,c,i]=n;for(var s in c)t.o(c,s)&&(t.m[s]=c[s]);for(i&&i(t);o.length;)e[o.pop()]=1;r(n)}})(),n=t.x,t.x=()=>t.e(911).then(n),t.x()})();