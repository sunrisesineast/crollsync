<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 2 Test - Room Management & Firebase Integration</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b35, #e55a2b);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .test-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section h2 {
            color: #333;
            border-bottom: 2px solid #ff6b35;
            padding-bottom: 10px;
            margin-top: 0;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .test-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: #fafafa;
        }
        
        .test-card h3 {
            margin-top: 0;
            color: #ff6b35;
        }
        
        button {
            background-color: #ff6b35;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #e55a2b;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px;
            width: 200px;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .room-display {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
        }
        
        .room-id {
            font-family: monospace;
            font-size: 24px;
            font-weight: bold;
            color: #ff6b35;
            margin: 10px 0;
        }
        
        .firebase-data {
            background-color: #e8f5e8;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .test-instructions {
            background-color: #f0f8ff;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 15px 0;
        }
        
        .test-instructions h4 {
            margin-top: 0;
            color: #007bff;
        }
        
        .test-instructions ol {
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üé¨ Crunchyroll Sync Extension - Phase 2 Test</h1>
        <p>Testing Room Management & Firebase Integration</p>
    </div>

    <!-- Firebase Connection Test -->
    <div class="test-section">
        <h2>üî• Firebase Connection Test</h2>
        <div class="test-instructions">
            <h4>Test Instructions:</h4>
            <ol>
                <li>Click "Test Firebase Connection" to verify Firebase is working</li>
                <li>Check the console for any errors</li>
                <li>Verify the status shows "Connected"</li>
            </ol>
        </div>
        
        <button onclick="testFirebaseConnection()">Test Firebase Connection</button>
        <button onclick="clearFirebaseTest()">Clear Test Data</button>
        
        <div id="firebaseStatus" class="status info" style="display: none;">
            Testing Firebase connection...
        </div>
        
        <div id="firebaseLog" class="log" style="display: none;"></div>
    </div>

    <!-- Room Management Test -->
    <div class="test-section">
        <h2>üè† Room Management Test</h2>
        <div class="test-instructions">
            <h4>Test Instructions:</h4>
            <ol>
                <li>Create a new room and note the room ID</li>
                <li>Join the room using the same ID</li>
                <li>Test leaving the room</li>
                <li>Try joining a non-existent room to test error handling</li>
            </ol>
        </div>
        
        <div class="test-grid">
            <div class="test-card">
                <h3>Create Room</h3>
                <button onclick="createTestRoom()">Create New Room</button>
                <div id="createRoomStatus" class="status info" style="display: none;"></div>
                <div id="roomDisplay" class="room-display" style="display: none;">
                    <div>Room ID:</div>
                    <div id="roomId" class="room-id"></div>
                </div>
            </div>
            
            <div class="test-card">
                <h3>Join Room</h3>
                <input type="text" id="joinRoomInput" placeholder="Enter 4-character room code" maxlength="4">
                <button onclick="joinTestRoom()">Join Room</button>
                <button onclick="joinInvalidRoom()">Test Invalid Room</button>
                <div id="joinRoomStatus" class="status info" style="display: none;"></div>
            </div>
            
            <div class="test-card">
                <h3>Room Actions</h3>
                <button onclick="leaveTestRoom()">Leave Room</button>
                <button onclick="getRoomInfo()">Get Room Info</button>
                <div id="roomActionsStatus" class="status info" style="display: none;"></div>
            </div>
        </div>
        
        <div id="roomLog" class="log" style="display: none;"></div>
    </div>

    <!-- Event Broadcasting Test -->
    <div class="test-section">
        <h2>üì° Event Broadcasting Test</h2>
        <div class="test-instructions">
            <h4>Test Instructions:</h4>
            <ol>
                <li>First create or join a room</li>
                <li>Broadcast test events (play, pause, seek)</li>
                <li>Check Firebase console to see events being pushed</li>
                <li>Test event listening by opening another browser tab</li>
            </ol>
        </div>
        
        <div class="test-grid">
            <div class="test-card">
                <h3>Broadcast Events</h3>
                <button onclick="broadcastPlayEvent()">Broadcast Play Event</button>
                <button onclick="broadcastPauseEvent()">Broadcast Pause Event</button>
                <button onclick="broadcastSeekEvent()">Broadcast Seek Event</button>
                <button onclick="broadcastCustomEvent()">Broadcast Custom Event</button>
                <div id="broadcastStatus" class="status info" style="display: none;"></div>
            </div>
            
            <div class="test-card">
                <h3>Event Monitoring</h3>
                <button onclick="startEventMonitoring()">Start Monitoring</button>
                <button onclick="stopEventMonitoring()">Stop Monitoring</button>
                <button onclick="clearEventLog()">Clear Event Log</button>
                <div id="monitoringStatus" class="status info" style="display: none;"></div>
            </div>
        </div>
        
        <div id="eventLog" class="log" style="display: none;"></div>
    </div>

    <!-- Firebase Data Viewer -->
    <div class="test-section">
        <h2>üìä Firebase Data Viewer</h2>
        <div class="test-instructions">
            <h4>Test Instructions:</h4>
            <ol>
                <li>Click "Refresh Data" to see current Firebase data</li>
                <li>Monitor rooms and events in real-time</li>
                <li>Use this to verify data persistence</li>
            </ol>
        </div>
        
        <button onclick="refreshFirebaseData()">Refresh Data</button>
        <button onclick="clearAllFirebaseData()">Clear All Data</button>
        
        <div id="firebaseData" class="firebase-data" style="display: none;"></div>
    </div>

    <!-- Test Results Summary -->
    <div class="test-section">
        <h2>üìã Test Results Summary</h2>
        <div id="testSummary" class="status info">
            <strong>Test Status:</strong> Ready to begin testing<br>
            <strong>Firebase Connection:</strong> Not tested<br>
            <strong>Room Management:</strong> Not tested<br>
            <strong>Event Broadcasting:</strong> Not tested<br>
            <strong>Overall Status:</strong> ‚è≥ Pending
        </div>
        
        <button onclick="runAllTests()">Run All Tests</button>
        <button onclick="resetTestResults()">Reset Results</button>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <script>
        // Firebase configuration (same as extension)
        const firebaseConfig = {
            apiKey: "AIzaSyBPEckKjp8aFmX58uos3MaK873RGuL30Nc",
            authDomain: "crunchysync-fe757.firebaseapp.com",
            databaseURL: "https://crunchysync-fe757-default-rtdb.firebaseio.com",
            projectId: "crunchysync-fe757",
            storageBucket: "crunchysync-fe757.firebasestorage.app",
            messagingSenderId: "891082210535",
            appId: "1:891082210535:web:53225e1bebc5b5d2e03642"
        };

        // Initialize Firebase
        let app, database, currentRoomRef, currentRoomId;
        let eventListener = null;
        let isMonitoring = false;
        let testResults = {
            firebaseConnection: false,
            roomManagement: false,
            eventBroadcasting: false
        };

        // Initialize Firebase
        function initializeFirebase() {
            try {
                app = firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                logMessage('firebaseLog', '‚úÖ Firebase initialized successfully');
                return true;
            } catch (error) {
                logMessage('firebaseLog', '‚ùå Firebase initialization failed: ' + error.message);
                return false;
            }
        }

        // Test Firebase connection
        async function testFirebaseConnection() {
            const statusEl = document.getElementById('firebaseStatus');
            const logEl = document.getElementById('firebaseLog');
            
            statusEl.style.display = 'block';
            logEl.style.display = 'block';
            statusEl.textContent = 'Testing Firebase connection...';
            statusEl.className = 'status info';
            
            try {
                if (!app) {
                    if (!initializeFirebase()) {
                        throw new Error('Failed to initialize Firebase');
                    }
                }
                
                // Test database write
                const testRef = database.ref('test/connection');
                await testRef.set({
                    timestamp: Date.now(),
                    message: 'Connection test from Phase 2 test page'
                });
                
                // Test database read
                const snapshot = await testRef.once('value');
                const data = snapshot.val();
                
                statusEl.textContent = '‚úÖ Firebase connection successful!';
                statusEl.className = 'status success';
                testResults.firebaseConnection = true;
                
                logMessage('firebaseLog', '‚úÖ Database write successful');
                logMessage('firebaseLog', '‚úÖ Database read successful');
                logMessage('firebaseLog', 'üìä Test data: ' + JSON.stringify(data, null, 2));
                
            } catch (error) {
                statusEl.textContent = '‚ùå Firebase connection failed: ' + error.message;
                statusEl.className = 'status error';
                testResults.firebaseConnection = false;
                logMessage('firebaseLog', '‚ùå Error: ' + error.message);
            }
            
            updateTestSummary();
        }

        // Clear Firebase test data
        async function clearFirebaseTest() {
            try {
                await database.ref('test').remove();
                logMessage('firebaseLog', 'üßπ Firebase test data cleared');
            } catch (error) {
                logMessage('firebaseLog', '‚ùå Error clearing test data: ' + error.message);
            }
        }

        // Create test room
        async function createTestRoom() {
            const statusEl = document.getElementById('createRoomStatus');
            const logEl = document.getElementById('roomLog');
            
            statusEl.style.display = 'block';
            logEl.style.display = 'block';
            statusEl.textContent = 'Creating room...';
            statusEl.className = 'status info';
            
            try {
                if (!database) {
                    throw new Error('Firebase not initialized');
                }
                
                // Generate 4-character room ID
                const roomId = Math.random().toString(36).substr(2, 4).toUpperCase();
                
                // Create room in Firebase
                const roomRef = database.ref('rooms/' + roomId);
                await roomRef.set({
                    created: Date.now(),
                    createdBy: 'phase2-test',
                    lastActivity: Date.now(),
                    testRoom: true
                });
                
                currentRoomRef = roomRef;
                currentRoomId = roomId;
                
                // Update UI
                document.getElementById('roomId').textContent = roomId;
                document.getElementById('roomDisplay').style.display = 'block';
                
                statusEl.textContent = '‚úÖ Room created successfully!';
                statusEl.className = 'status success';
                
                logMessage('roomLog', '‚úÖ Room created: ' + roomId);
                logMessage('roomLog', 'üìä Room data saved to Firebase');
                
            } catch (error) {
                statusEl.textContent = '‚ùå Failed to create room: ' + error.message;
                statusEl.className = 'status error';
                logMessage('roomLog', '‚ùå Error: ' + error.message);
            }
        }

        // Join test room
        async function joinTestRoom() {
            const roomId = document.getElementById('joinRoomInput').value.trim().toUpperCase();
            const statusEl = document.getElementById('joinRoomStatus');
            const logEl = document.getElementById('roomLog');
            
            if (!roomId || roomId.length !== 4) {
                alert('Please enter a valid 4-character room code');
                return;
            }
            
            statusEl.style.display = 'block';
            logEl.style.display = 'block';
            statusEl.textContent = 'Joining room...';
            statusEl.className = 'status info';
            
            try {
                if (!database) {
                    throw new Error('Firebase not initialized');
                }
                
                // Check if room exists
                const roomRef = database.ref('rooms/' + roomId);
                const snapshot = await roomRef.once('value');
                
                if (!snapshot.exists()) {
                    throw new Error('Room does not exist');
                }
                
                // Update room activity
                await roomRef.update({
                    lastActivity: Date.now(),
                    joinedBy: 'phase2-test'
                });
                
                currentRoomRef = roomRef;
                currentRoomId = roomId;
                
                statusEl.textContent = '‚úÖ Joined room successfully!';
                statusEl.className = 'status success';
                
                logMessage('roomLog', '‚úÖ Joined room: ' + roomId);
                logMessage('roomLog', 'üìä Room data: ' + JSON.stringify(snapshot.val(), null, 2));
                
            } catch (error) {
                statusEl.textContent = '‚ùå Failed to join room: ' + error.message;
                statusEl.className = 'status error';
                logMessage('roomLog', '‚ùå Error: ' + error.message);
            }
        }

        // Test joining invalid room
        async function joinInvalidRoom() {
            const statusEl = document.getElementById('joinRoomStatus');
            const logEl = document.getElementById('roomLog');
            
            statusEl.style.display = 'block';
            logEl.style.display = 'block';
            statusEl.textContent = 'Testing invalid room...';
            statusEl.className = 'status info';
            
            try {
                const invalidRoomId = 'XXXX';
                const roomRef = database.ref('rooms/' + invalidRoomId);
                const snapshot = await roomRef.once('value');
                
                if (!snapshot.exists()) {
                    statusEl.textContent = '‚úÖ Invalid room test passed!';
                    statusEl.className = 'status success';
                    logMessage('roomLog', '‚úÖ Correctly rejected invalid room: ' + invalidRoomId);
                } else {
                    throw new Error('Room should not exist');
                }
                
            } catch (error) {
                statusEl.textContent = '‚ùå Invalid room test failed: ' + error.message;
                statusEl.className = 'status error';
                logMessage('roomLog', '‚ùå Error: ' + error.message);
            }
        }

        // Leave test room
        async function leaveTestRoom() {
            const statusEl = document.getElementById('roomActionsStatus');
            const logEl = document.getElementById('roomLog');
            
            statusEl.style.display = 'block';
            logEl.style.display = 'block';
            statusEl.textContent = 'Leaving room...';
            statusEl.className = 'status info';
            
            try {
                if (currentRoomRef && eventListener && isMonitoring) {
                    // Set flag first to prevent processing new events
                    isMonitoring = false;
                    
                    // Firebase listener cleanup - call the listener function to remove it
                    eventListener();
                    eventListener = null;
                }
                
                currentRoomRef = null;
                currentRoomId = null;
                
                // Hide room display
                document.getElementById('roomDisplay').style.display = 'none';
                
                statusEl.textContent = '‚úÖ Left room successfully!';
                statusEl.className = 'status success';
                
                logMessage('roomLog', '‚úÖ Left room successfully');
                
            } catch (error) {
                statusEl.textContent = '‚ùå Failed to leave room: ' + error.message;
                statusEl.className = 'status error';
                logMessage('roomLog', '‚ùå Error: ' + error.message);
            }
        }

        // Get room info
        async function getRoomInfo() {
            const statusEl = document.getElementById('roomActionsStatus');
            const logEl = document.getElementById('roomLog');
            
            statusEl.style.display = 'block';
            logEl.style.display = 'block';
            statusEl.textContent = 'Getting room info...';
            statusEl.className = 'status info';
            
            try {
                if (!currentRoomRef) {
                    throw new Error('Not connected to any room');
                }
                
                const snapshot = await currentRoomRef.once('value');
                const roomData = snapshot.val();
                
                statusEl.textContent = '‚úÖ Room info retrieved!';
                statusEl.className = 'status success';
                
                logMessage('roomLog', 'üìä Room Info for ' + currentRoomId + ':');
                logMessage('roomLog', JSON.stringify(roomData, null, 2));
                
            } catch (error) {
                statusEl.textContent = '‚ùå Failed to get room info: ' + error.message;
                statusEl.className = 'status error';
                logMessage('roomLog', '‚ùå Error: ' + error.message);
            }
        }

        // Broadcast play event
        async function broadcastPlayEvent() {
            await broadcastEvent({
                type: 'play',
                timestamp: Date.now(),
                currentTime: 120.5
            });
        }

        // Broadcast pause event
        async function broadcastPauseEvent() {
            await broadcastEvent({
                type: 'pause',
                timestamp: Date.now(),
                currentTime: 180.2
            });
        }

        // Broadcast seek event
        async function broadcastSeekEvent() {
            await broadcastEvent({
                type: 'seek',
                timestamp: Date.now(),
                currentTime: 300.0
            });
        }

        // Broadcast custom event
        async function broadcastCustomEvent() {
            const customTime = Math.random() * 600; // Random time up to 10 minutes
            await broadcastEvent({
                type: 'custom',
                timestamp: Date.now(),
                currentTime: customTime,
                message: 'Custom test event'
            });
        }

        // Broadcast event to Firebase
        async function broadcastEvent(event) {
            const statusEl = document.getElementById('broadcastStatus');
            const logEl = document.getElementById('eventLog');
            
            statusEl.style.display = 'block';
            logEl.style.display = 'block';
            statusEl.textContent = 'Broadcasting event...';
            statusEl.className = 'status info';
            
            try {
                if (!currentRoomRef) {
                    throw new Error('Not connected to any room');
                }
                
                const eventData = {
                    ...event,
                    timestamp: Date.now(),
                    sentBy: 'phase2-test'
                };
                
                const eventsRef = currentRoomRef.child('events');
                const newEventRef = await eventsRef.push(eventData);
                
                // Update room activity
                await currentRoomRef.update({
                    lastActivity: Date.now()
                });
                
                statusEl.textContent = '‚úÖ Event broadcasted successfully!';
                statusEl.className = 'status success';
                
                logMessage('eventLog', '‚úÖ Event broadcasted: ' + event.type);
                logMessage('eventLog', 'üìä Event data: ' + JSON.stringify(eventData, null, 2));
                logMessage('eventLog', 'üîë Event key: ' + newEventRef.key);
                
            } catch (error) {
                statusEl.textContent = '‚ùå Failed to broadcast event: ' + error.message;
                statusEl.className = 'status error';
                logMessage('eventLog', '‚ùå Error: ' + error.message);
            }
        }

        // Start event monitoring
        function startEventMonitoring() {
            const statusEl = document.getElementById('monitoringStatus');
            const logEl = document.getElementById('eventLog');
            
            statusEl.style.display = 'block';
            logEl.style.display = 'block';
            statusEl.textContent = 'Starting event monitoring...';
            statusEl.className = 'status info';
            
            try {
                if (!currentRoomRef) {
                    throw new Error('Not connected to any room');
                }
                
                const eventsRef = currentRoomRef.child('events');
                isMonitoring = true;
                eventListener = eventsRef.on('child_added', (snapshot) => {
                    try {
                        // Check if we're still monitoring and snapshot is valid
                        if (!isMonitoring || !snapshot || !snapshot.exists()) {
                            return;
                        }
                        
                        const event = snapshot.val();
                        if (!event) {
                            return;
                        }
                        
                        logMessage('eventLog', 'üì° Received event: ' + event.type);
                        logMessage('eventLog', 'üìä Event data: ' + JSON.stringify(event, null, 2));
                    } catch (error) {
                        // Silently handle errors during listener cleanup
                        console.log('Event listener error (likely during cleanup):', error.message);
                    }
                });
                
                statusEl.textContent = '‚úÖ Event monitoring started!';
                statusEl.className = 'status success';
                
                logMessage('eventLog', '‚úÖ Event monitoring started for room: ' + currentRoomId);
                
            } catch (error) {
                statusEl.textContent = '‚ùå Failed to start monitoring: ' + error.message;
                statusEl.className = 'status error';
                logMessage('eventLog', '‚ùå Error: ' + error.message);
            }
        }

        // Stop event monitoring
        function stopEventMonitoring() {
            const statusEl = document.getElementById('monitoringStatus');
            const logEl = document.getElementById('eventLog');
            
            statusEl.style.display = 'block';
            logEl.style.display = 'block';
            
            try {
                if (eventListener && isMonitoring) {
                    // Set flag first to prevent processing new events
                    isMonitoring = false;
                    
                    // Firebase listener cleanup - call the listener function to remove it
                    eventListener();
                    eventListener = null;
                    
                    statusEl.textContent = '‚úÖ Event monitoring stopped!';
                    statusEl.className = 'status success';
                    logMessage('eventLog', '‚úÖ Event monitoring stopped');
                } else {
                    statusEl.textContent = '‚ÑπÔ∏è No active monitoring to stop';
                    statusEl.className = 'status info';
                    logMessage('eventLog', '‚ÑπÔ∏è No active monitoring to stop');
                }
                
            } catch (error) {
                statusEl.textContent = '‚ùå Failed to stop monitoring: ' + error.message;
                statusEl.className = 'status error';
                logMessage('eventLog', '‚ùå Error: ' + error.message);
            }
        }

        // Clear event log
        function clearEventLog() {
            document.getElementById('eventLog').textContent = '';
        }

        // Refresh Firebase data
        async function refreshFirebaseData() {
            const dataEl = document.getElementById('firebaseData');
            dataEl.style.display = 'block';
            dataEl.textContent = 'Loading Firebase data...';
            
            try {
                if (!database) {
                    throw new Error('Firebase not initialized');
                }
                
                const snapshot = await database.ref().once('value');
                const data = snapshot.val();
                
                dataEl.textContent = JSON.stringify(data, null, 2);
                
            } catch (error) {
                dataEl.textContent = 'Error loading data: ' + error.message;
            }
        }

        // Clear all Firebase data
        async function clearAllFirebaseData() {
            if (confirm('Are you sure you want to clear ALL Firebase data? This cannot be undone!')) {
                try {
                    await database.ref().remove();
                    document.getElementById('firebaseData').textContent = 'All Firebase data cleared.';
                } catch (error) {
                    alert('Error clearing data: ' + error.message);
                }
            }
        }

        // Run all tests
        async function runAllTests() {
            const summaryEl = document.getElementById('testSummary');
            summaryEl.innerHTML = '<strong>Test Status:</strong> Running all tests...<br>';
            
            // Test Firebase connection
            await testFirebaseConnection();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Test room management
            await createTestRoom();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Test event broadcasting
            await broadcastPlayEvent();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            updateTestSummary();
        }

        // Reset test results
        function resetTestResults() {
            testResults = {
                firebaseConnection: false,
                roomManagement: false,
                eventBroadcasting: false
            };
            updateTestSummary();
        }

        // Update test summary
        function updateTestSummary() {
            const summaryEl = document.getElementById('testSummary');
            const firebaseStatus = testResults.firebaseConnection ? '‚úÖ Passed' : '‚ùå Failed';
            const roomStatus = testResults.roomManagement ? '‚úÖ Passed' : '‚ùå Failed';
            const eventStatus = testResults.eventBroadcasting ? '‚úÖ Passed' : '‚ùå Failed';
            
            const overallStatus = Object.values(testResults).every(result => result) ? '‚úÖ All Tests Passed' : '‚ùå Some Tests Failed';
            
            summaryEl.innerHTML = `
                <strong>Test Status:</strong> ${overallStatus}<br>
                <strong>Firebase Connection:</strong> ${firebaseStatus}<br>
                <strong>Room Management:</strong> ${roomStatus}<br>
                <strong>Event Broadcasting:</strong> ${eventStatus}<br>
                <strong>Overall Status:</strong> ${overallStatus}
            `;
            
            summaryEl.className = Object.values(testResults).every(result => result) ? 'status success' : 'status error';
        }

        // Log message to specified element
        function logMessage(elementId, message) {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            element.textContent += `[${timestamp}] ${message}\n`;
            element.scrollTop = element.scrollHeight;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Phase 2 Test Page Loaded');
            initializeFirebase();
        });
    </script>
</body>
</html>
